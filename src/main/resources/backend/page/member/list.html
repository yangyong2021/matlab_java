<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="../../plugins/element-ui/index.css" />
    <link rel="stylesheet" href="../../styles/common.css" />
    <link rel="stylesheet" href="../../styles/page.css" />
    <style>
      #member-app .notAdmin::after {
        border: 0 !important;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container" id="member-app">
      <div class="container">
        <div class="tableBar">
          <el-input
            v-model="input"
            placeholder="请输入方法名"
            style="width: 250px"
            clearable
            @keyup.enter.native="handleQuery"
          >
            <i
              slot="prefix"
              class="el-input__icon el-icon-search"
              style="cursor: pointer"
              @click="handleQuery"
            ></i>
          </el-input>
          <el-button
            type="primary"
            class="continue"
            @click="addMemberHandle('test')"
          >
            + 测试
          </el-button>
          <el-button type="primary" @click="addMemberHandle('add')">
            + 新增方法寻优
          </el-button>
        </div>
        <el-table :data="tableData" stripe class="tableBox">
          <el-table-column
            style="font-family: 'Times New Roman'"
            prop="name"
            label="方法名称"
          ></el-table-column>
          <el-table-column
            style="font-family: 'Times New Roman'"
            prop="dataname"
            label="数据集名称"
          ></el-table-column>
          <el-table-column
            prop="predata"
            label="数据预处理方式"
          ></el-table-column>
          <el-table-column label="寻优状态">
            <template slot-scope="scope">
              <template v-if="String(scope.row.status) === '0'">
                <el-button
                  type="danger"
                  round
                  style="height: 25px; padding: 0px 10px"
                  >未寻优</el-button
                >
              </template>
              <template v-else-if="String(scope.row.status) === '1'">
                <el-button
                  type="success"
                  round
                  style="height: 25px; padding: 0px 10px"
                  >已寻优</el-button
                >
              </template>
              <template v-else>
                <el-button
                  type="primary"
                  round
                  style="height: 25px; padding: 0px 10px"
                >
                  <i class="el-icon-loading"></i>
                  <span style="vertical-align: middle">寻优中</span>
                </el-button>
              </template>
            </template>
          </el-table-column>
          <el-table-column label="操作" width="160" align="center">
            <template slot-scope="scope">
              <el-button
                type="text"
                size="small"
                class="blueBug"
                @click="addMemberHandle(scope.row.id)"
                :class="{notAdmin:user !== 'admin'}"
              >
                编辑
              </el-button>
              <el-button
                type="text"
                size="small"
                class="delBut non"
                @click="statusHandle(scope.row)"
              >
                <!--                            v-if="user === 'admin'"-->

                删除
              </el-button>
            </template>
          </el-table-column>
        </el-table>
        <el-pagination
          class="pageList"
          :page-sizes="[10, 20, 30, 40]"
          :page-size="pageSize"
          layout="total, sizes, prev, pager, next, jumper"
          :total="counts"
          :current-page.sync="page"
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
        ></el-pagination>
      </div>
      <el-dialog
        :title="classData.title"
        :visible.sync="classData.dialogVisible"
        width="30%"
        :before-close="handleClose"
      >
        <el-form class="demo-form-inline" label-width="100px">
          <el-form-item label="分类名称：">
            <el-input
              v-model="classData.name"
              placeholder="请输入分类名称"
              maxlength="14"
            />
          </el-form-item>
          <el-form-item label="排序：">
            <el-input
              v-model="classData.sort"
              type="number"
              placeholder="请输入排序"
            />
          </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
          <el-button size="medium" @click="classData.dialogVisible = false"
            >取 消</el-button
          >
          <el-button type="primary" size="medium" @click="submitForm()"
            >确 定</el-button
          >
          <el-button
            v-if="action != 'edit'"
            type="primary"
            size="medium"
            class="continue"
            @click="submitForm('go')"
          >
            保存并继续添加
          </el-button>
        </span>
      </el-dialog>
    </div>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="../../plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="../../plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="../../plugins/axios/axios.min.js"></script>
    <script src="../../js/request.js"></script>
    <script src="../../api/member.js"></script>
    <script>
      new Vue({
        el: "#member-app",
        data() {
          return {
            input: "",
            counts: 0,
            page: 1,
            pageSize: 10,
            tableData: [
              {
                name: "LRDSMG",
                dataname: "flags",
                predata: "l21-norm",
                status: 2,
              },
            ],
            id: "",
            status: "",
            classData: {
              title: "添加菜品分类",
              dialogVisible: false,
              categoryId: "",
              name: "",
              sort: "",
            },
          };
        },
        computed: {},
        created() {
          this.init();
          this.user = JSON.parse(localStorage.getItem("userInfo")).dataname;
        },
        mounted() {},
        methods: {
          async init() {
            const params = {
              page: this.page,
              pageSize: this.pageSize,
              name: this.input ? this.input : undefined,
            };
            await getMemberList(params)
              .then((res) => {
                if (String(res.code) === "1") {
                  this.tableData = res.data.records || [];
                  this.counts = res.data.total;
                }
              })
              .catch((err) => {
                this.$message.error("请求出错了：" + err);
              });
          },
          handleQuery() {
            this.page = 1;
            this.init();
          },
          // 添加
          addMemberHandle(st) {
            if (st === "add") {
              window.parent.menuHandle(
                {
                  id: "2",
                  url: "/backend/page/member/add.html",
                  name: "添加员工",
                },
                true
              );
            } else if (st === "test") {
              this.classData.title = "收敛性曲线";
              this.classData.dialogVisible = true;
            } else {
              window.parent.menuHandle(
                {
                  id: "2",
                  url: "/backend/page/member/add.html?id=" + st,
                  name: "修改员工",
                },
                true
              );
            }
          },
          //状态修改
          statusHandle(row) {
            this.id = row.id;
            this.status = row.status;
            this.$confirm("删除该方法?", "提示", {
              confirmButtonText: "确定",
              cancelButtonText: "取消",
              type: "warning",
            }).then(() => {
              deleteMethod({ id: this.id, status: !this.status ? 1 : 0 })
                .then((res) => {
                  console.log("enableOrDisableEmployee", res);
                  if (String(res.code) === "1") {
                    this.$message.success("账号状态更改成功！");
                    this.handleQuery();
                  }
                })
                .catch((err) => {
                  this.$message.error("请求出错了：" + err);
                });
            });
          },
          handleSizeChange(val) {
            this.pageSize = val;
            this.init();
          },
          handleCurrentChange(val) {
            this.page = val;
            this.init();
          },
        },
      });
    </script>
  </body>
</html>
